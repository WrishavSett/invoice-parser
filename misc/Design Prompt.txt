The client has provided me with invoices in pdf format. One of which named invoice3.pdf can be found in the root directory of my project for your reference.

As of now, I have planned my codebase to have 4 files:
1. gemini_client.py
2. helper.py
3. validator.py
4. main.py


gemini_client.py:

```
#!/usr/bin/python3

def gemini_client(image_path: str):
    """
    Calls the Gemini API to extract structured data from invoice image.
    args:
        image_path: Path to the image file.
    returns:
        RAW JSON response from Gemini API.
    """
    api_key = "AIzaSyDaeDDdn6SUcjBOOEXnyhqTf-FAj2kV8Lw"
    model_name = "gemini-3-flash-preview"

    try:
        from google import genai
        from google.genai import types
    except:
        raise ImportError("Please run `pip install google-genai` package to use the Gemini client.")

    try:
        client = genai.Client(api_key=api_key)
    except:
        if api_key is not None:
            raise ImportError("API key not configured properly.")
        else:
            raise ImportError("API key not provided.")

    response_schema = {
        "type": "object",
        "properties": {
            "letter_head": {
                "type": "object",
                "properties": {
                    "company_name": {"type": "string"},
                    "former_company_name": {"type": "string"},
                    "address": {"type": "string"},
                    "cin": {"type": "string"},
                    "gstin": {"type": "string"},
                    "phone": {"type": "string"},
                    "email": {"type": "string"},
                    "website": {"type": "string"}
                },
                "required": [
                    "company_name",
                    "former_company_name",
                    "address",
                    "cin",
                    "gstin",
                    "phone",
                    "email",
                    "website"
                ]
            },

            "tax_invoice": {
                "type": "object",
                "properties": {
                    "pan_no": {"type": "string"},
                    "tan_no": {"type": "string"}
                },
                "required": ["pan_no", "tan_no"]
            },

            "bill_to_details": {
                "type": "object",
                "properties": {
                    "company_name": {"type": "string"},
                    "address": {"type": "string"},
                    "gstin": {"type": "string"},
                    "pan_no": {"type": "string"},
                    "tan_no": {"type": "string"},
                    "place_of_supply": {"type": "string"},
                    "irn_no": {"type": "string"}
                },
                "required": [
                    "company_name",
                    "address",
                    "gstin",
                    "pan_no",
                    "tan_no",
                    "place_of_supply",
                    "irn_no"
                ]
            },

            "invoice_details": {
                "type": "object",
                "properties": {
                    "date": {"type": "string"},
                    "invoice_no": {"type": "string"},
                    "service_month": {"type": "string"},
                    "lower_tds_cert_no": {"type": "string"}
                },
                "required": [
                    "date",
                    "invoice_no",
                    "service_month",
                    "lower_tds_cert_no"
                ]
            },

            "resource_and_bill_details": {
                "type": "array",
                "minItems": 1,
                "items": {
                    "type": "object",
                    "properties": {
                        "sl_no": {"type": "string"},
                        "resource_name": {"type": "string"},
                        "hsn_sac": {"type": "string"},
                        "po_no": {"type": "string"},
                        "bill_rate": {"type": "string"},
                        "ericsson_invoice_code": {"type": "string"},
                        "taxable_value": {"type": "string"},
                        "cgst": {"type": "string"},
                        "sgst": {"type": "string"},
                        "igst": {"type": "string"},
                        "total_inr": {"type": "string"}
                    },
                    "required": [
                        "sl_no",
                        "resource_name",
                        "hsn_sac",
                        "po_no",
                        "bill_rate",
                        "ericsson_invoice_code",
                        "taxable_value",
                        "cgst",
                        "sgst",
                        "igst",
                        "total_inr"
                    ]
                }
            },

            "total_invoice_value": {
                "type": "object",
                "properties": {
                    "taxable_value": {"type": "string"},
                    "cgst": {"type": "string"},
                    "sgst": {"type": "string"},
                    "igst": {"type": "string"},
                    "total_inr": {"type": "string"},
                    "in_words": {"type": "string"}
                },
                "required": [
                    "taxable_value",
                    "cgst",
                    "sgst",
                    "igst",
                    "total_inr",
                    "in_words"
                ]
            },

            "arn_for_lut": {"type": "string"},

            "supply": {"type": "string"},

            "igst_foregone": {"type": "string"},

            "note": {
                "type": "object",
                "properties": {
                    "1": {"type": "string"},
                    "2": {"type": "string"},
                    "post_script": {"type": "string"}
                },
                "required": [
                    "1",
                    "2",
                    "post_script"
                ]
            },

            "beneficiary_details": {
                "type": "object",
                "properties": {
                    "beneficiary_name": {"type": "string"},
                    "bank_name": {"type": "string"},
                    "address": {"type": "string"},
                    "reverse_charge": {"type": "string"},
                    "account_no": {"type": "string"},
                    "ifsc_code": {"type": "string"},
                    "micr_code": {"type": "string"},
                    "country": {"type": "string"},
                    "authorised_signatory": {"type": "string"}
                },
                "required": [
                    "beneficiary_name",
                    "bank_name",
                    "address",
                    "reverse_charge",
                    "account_no",
                    "ifsc_code",
                    "micr_code",
                    "country",
                    "authorised_signatory"
                ]
            },

            "qr_code": {"type": "string"},

            "digital_signature": {"type": "string"}
        },
        "required": [
            "letter_head",
            "tax_invoice",
            "bill_to_details",
            "invoice_details",
            "resource_and_bill_details",
            "total_invoice_value",
            "arn_for_lut",
            "supply",
            "igst_foregone",
            "note",
            "beneficiary_details",
            "qr_code",
            "digital_signature"
        ]
    }

    def call_llm(prompt, image_path, model_name, response_schema):
        try:
            with open(image_path, 'rb') as f:
                image_bytes = f.read()
        except:
            if image_path is not None:
                raise ImportError("Image path provided is invalid.")
            else:
                raise ImportError("Image path not provided.")

        response = client.models.generate_content(
            model = model_name,
            contents = [
                types.Part.from_bytes(
                    data = image_bytes,
                    mime_type = 'image/jpeg',
                ),
                prompt
            ],
            config = types.GenerateContentConfig(
                thinking_config = types.ThinkingConfig(thinking_budget=0), # Disables thinking
                system_instruction = """You are an expert at extracting structured data from images.
Return ONLY a valid JSON object that strictly adheres to the specified schema.
If a value is missing, return an empty string "".""",
                temperature = 0.1,
                response_mime_type = "application/json",
                response_schema = response_schema
            )
        )

        return response

    prompt = """Extract data from the provided invoice image.

Rules:

Return ONLY the actual values, NOT the labels.
Example 1: From "CIN No:U74140WB1993PLC059586", return only "U74140WB1993PLC059586"
Example 2: From "Pan No : AACCE4175D", return only "AACCE4175D"
Example 3: From "TAN NO : CALG02952F", return only "CALG02952F"

Preserve formatting.
Example 1: From "(Formerly known as Genius Consultants Limited)", return "(Formerly known as Genius Consultants Limited)" and not "Formerly known as Genius Consultants Limited"
Example 2: From "GWBIAR/NV0001/26", return "GWBIAR/NV0001/26" and not "GWBIARNV000126" or "GWBIAR NV000 126" or something else
Example 3: From "AACCE4175D", return "AACCE4175D" and not "AACC E4175D" or something else

For blank fields, STRICTLY return "".

For Resource and Bill Details and Total Invoice Value, properly follow table outlines to extract the data.

For the Note, maintain a clear separation of points 1 and 2, and, the post script.

For the QR Code, return "True" (if Present) or "False" (if Absent).

For Digital Signature, return "True" (if Present) or "False" (if Absent).

If there are any key objects that are missing, do NOT omit them. Instead return "" as values against the keys."""

    response = call_llm(prompt, image_path, model_name, response_schema)

    return response
```

It accepts the invoice as an image file, extracts data from it as per given prompt and returns in the specified schema.

Output of gemini_client.py for invoice3.pdf:

```
{
  "letter_head": {
    "company_name": "Genius HRTech Limited",
    "former_company_name": "(Formerly known as Genius Consultants Limited)",
    "address": "Synthesis Business Park Tower,1C, 1st Floor, CBD/1,Action Area II. New Town,Kolkata- 700157.",
    "cin": "U74140WB1993PLC059586",
    "gstin": "19AABCG1661M1ZE",
    "phone": "033-66415800/01",
    "email": "enquiry@geniushrtech.com",
    "website": "www.geniushrtech.com"
  },
  "tax_invoice": {
    "pan_no": "AABCG1661M",
    "tan_no": "CALG02952F"
  },
  "bill_to_details": {
    "company_name": "ERICSSON INDIA PRIVATE LIMITED",
    "address": "Grd To 14th Floor Block A, ASF INSIGNIA, KINGS CANYON ASF INSIGNIA, Ground Floor Block B Kings Canyon, GAWAL PAHARI, Gurugram, Gurugram, Haryana, 122003 , GURGAON, HARYANA 122003",
    "gstin": "06AACCE4175D2ZX",
    "pan_no": "AACCE4175D",
    "tan_no": "DELE05521F",
    "place_of_supply": "HARYANA-06",
    "irn_no": "9b4667d2ede02b76ae490c45065fc3c2ae0feb55c3ca836733dfa18ff024b7d7"
  },
  "invoice_details": {
    "date": "17 Nov 2025",
    "invoice_no": "GWBIRM/NV0013/26",
    "service_month": "October,2025",
    "lower_tds_cert_no": "1AB0325BHZ"
  },
  "resource_and_bill_details": [
    {
      "sl_no": "1",
      "resource_name": "HEISNAM SHIBANANDA",
      "hsn_sac": "998513",
      "po_no": "8000112653",
      "bill_rate": "4000.00",
      "ericsson_invoice_code": "ERCSMI00228103",
      "taxable_value": "4160.00",
      "cgst": "",
      "sgst": "",
      "igst": "",
      "total_inr": "4160.00"
    }
  ],
  "total_invoice_value": {
    "taxable_value": "4160.00",
    "cgst": "",
    "sgst": "",
    "igst": "",
    "total_inr": "4160.00",
    "in_words": "Rupees Four Thousand One Hundred Sixty and Paisa Only."
  },
  "arn_for_lut": "AD190225017242G",
  "supply": "Supply to SEZ unit or SEZ Developer for authorized operations under Bond or Letter of undertaking without payment of Integrated Tax.",
  "igst_foregone": "749.00",
  "note": {
    "1": "Please check the calculation/attendance/amount of the bill and inform us within 48 hours in case of any discrepancy, to avoid last minute rush. Any changes reported after 48 hours will be adjusted along with the next month's bill.",
    "2": "As per the IT rule u/s 194JB, if our Invoices value in a year is more than Rs. 50,000/-, then you may deduct TDS @ 0.50% Excluding GST",
    "post_script": "For any kind of GST related query, please contact at : gstsupport@geniushrtech.com"
  },
  "beneficiary_details": {
    "beneficiary_name": "Genius HRTech Limited (Formerly known as Genius Consultants Limited)",
    "bank_name": "HDFC BANK LTD",
    "address": "2/6 SARAT BOSE ROAD",
    "reverse_charge": "No",
    "account_no": "00228640000037",
    "ifsc_code": "HDFC0000014",
    "micr_code": "700240099",
    "country": "India",
    "authorised_signatory": ""
  },
  "qr_code": "True",
  "digital_signature": "True"
}
```

Note: The invoice .pdf file was first converted to a .jpg file and saved temporarily and then the path to the saved image was passed to the function as a string. The output has printed using json.dumps command with indent set to 2 for better readability. The code gemini_client.py will remain unchanged moving forward.

Note: The invoices will always be single page.




I do NOT want use LLM for anything more than data extraction. As such I will need to use Python and available libraries for validation.

As for validation rules, data based validation can be done via the extracted JSON, but 2 checks, namely:
2.1 The exact text "TAX INVOICE" is in bold and reflected, and,
7.1 The exact text "Bank details for money transfer as follows" is in bold and reflected,
Cannot be validated in the same way. Validating these 2 checks will require analyzing the pdf directly for font styles and presence.

I read that pymupdf, language-tool-python and num2word (or word2num) can be used for my use case.

Discuss an exhaustive plan of action for the whole codebase including gemini_client.py, helper.py, validator.py and main.py to achieve the desired outcome.